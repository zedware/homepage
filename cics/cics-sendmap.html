<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<base target="_self" href="http://www.s390.ibm.com:80/bookmgr-cgi/bookmgr.cmd/BOOKS/DFHZP104/3%2e3%2e2%2e2">
<SCRIPT LANGUAGE="JavaScript">

<!--

if(parent.location.href != window.location.href)

  parent.location.href = window.location.href;

//-->

</SCRIPT>
<title>3.3.2.2"CICS Application Programming Primer"via IBM BookManager BookServer</title>
</head>
<body background=""> 
<banner> <a href="../../library"><img src="" border=0 alt="[Library]"></a> <a href="../../Shelves/DFHZA910"><img src="" border=0 alt="[Bookshelf]"></a> <a  href=""><img src="" border=0 alt="[Contents]"></a> <img src="" border=0 alt="[Revisions]"> <a href=""><img src="" border=0 alt="[Prev Topic]"></a> <a href=""><img src="" border=0 alt="[Next Topic]"></a> <a href="../../search?book=DFHZP104&SHELF=DFHZA910"><img src="" border=0 alt="[Search]" ></a> <img src="" border=0 alt="[Search Results]"> <img src="" border=0 alt="[Prev Topic Match]"> <img src="" border=0 alt="[Next Topic Match]"> <img src="" border=0 alt="[Notes]"> <img src="" border=0 alt="[List Notes]"> <a  href="../../print?book=DFHZP104"><img src="" border=0 alt="[Print]"></a> <a href="../../download/DFHZP104.boo"><img src="" border=0 alt="[Download]" ></a> <a  href="../../help/book"><img src="" border=0 alt="[Help]"></a> 
<hr> 
<H3> 3.3.2.2 Using SEND MAP in the ACCT example</H3> 
</banner> 
<pre width="80">
   The first time we need to send a map to a terminal occurs in program 

   <tt>ACCT00,</tt> where we display the menu screen.  The command we need is: 

<p>

<a name="FIGFIGUNIQ32">    ________________________________________________________________________  </a>

   |                                                                        | 

   |   EXEC CICS SEND MAP('ACCTMNU') MAPSET('ACCTSET') MAPONLY              | 

   |        ERASE FREEKB END-EXEC.                                          | 

   |                                                                        | 

   |________________________________________________________________________| 


   This is a very simple situation.  Because we don't have any variable data 

   to put in the map, we can use the <tt>MAPONLY</tt> option, and we don't have to 

   worry about preparing variable data for merging with the physical map. 

<p>

   If we were sending some data to the screen with the map, we could not use 

   <tt>MAPONLY,</tt> and CICS would expect the data to be used for filling in the map 

   to be in a structure whose name is the map name (as specified in the <tt>MAP</tt> 

   option) suffixed with the letter <tt>O.</tt>  So, when we issue the command: 
<a name="FIGFIGUNIQ33">    ________________________________________________________________________  </a>

   |                                                                        | 

   |   EXEC CICS SEND MAP('ACCTMNU') MAPSET('ACCTSET')                      | 

   |        END-EXEC.                                                       | 

   |                                                                        | 

   |________________________________________________________________________| 

   CICS expects the data for the map to be in a structure within the program 

   (of exactly the sort generated by the <tt>DSECT</tt> assembly) named <tt>ACCTMNUO.</tt> 

   This structure is usually in your <tt>WORKING-STORAGE</tt> Section, but it might be 

   in a <tt>LINKAGE</tt> area instead.  (There's an option on the <tt>SEND</tt> <tt>MAP</tt> command 

   that lets you specify a data structure other than the one assumed by CICS. 

   We won't cover it here, but you can find guidance on using it in the 

   <a href="../../DOCNUM/SC33-0675/CCONTENTS">CICS/ESA Application Programming Guide</a>.  under &quot;Sending Data to a 

   Display.&quot;) 


   Let's look at the more common situation in which we're merging program 

   data into the map.  In program <tt>ACCT01,</tt> we're supposed to build a detail 

   display map for one record and send it to the screen.  Since the contents 

   of the screen vary somewhat with the type of request, and we're using the 

   same screen for all types, this will entail the following: 

<p>

   1.  Putting the appropriate title on the map (add, modify, or whatever it 

       happens to be). 

   2.  Moving the data from the file record to the symbolic map (except for 

       adds). 
   3.  Adjusting the attribute bytes.  The input fields must be protected in 

       a display or delete operation; the &quot;verify&quot; field must be unprotected 

       for deletes, and the titles at the bottom of the screen must be made 

       nondisplay for adds. 
   4.  Putting the appropriate user instructions (about what to do next) into 

       the message area. 
   5.  Putting the cursor in the right place. 

<a href="">Figure 43</a> shows how the necessary code might look. 

<a name="FIGCODE1">    ________________________________________________________________________  </a>

   |                                                                        | 

   | Col  Col                                                               | 

   | 7    12                                                                | 

   |  BUILD-MAP.                                                            | 

   |      IF REQC = 'X' MOVE 'DELETION' TO TITLEDO,                         | 

   |          MOVE -1 TO VFYDL, MOVE DFHBMUNP TO VFYDA,                     | 

   |          MOVE 'ENTER &quot;Y&quot; TO CONFIRM OR &quot;CLEAR&quot; TO CANCEL'              | 

   |              TO MSGDO,                                                 | 

   |      ELSE MOVE -1 TO SNAMEDL.                                          | 

   |      IF REQC = 'A' MOVE 'NEW RECORD' TO TITLEDO,                       | 

   |          MOVE DFHPROTN TO STATTLDA, LIMTTLDA, HISTTLDA,                | 

   |          MOVE ACCTC TO ACCTDI,                                         | 

   |          MOVE 'FILL IN AND PRESS &quot;ENTER,&quot; OR &quot;CLEAR&quot; TO CANCEL'        | 

   |              TO MSGDO,                                                 | 

   |          GO TO SEND-DETAIL.                                            | 

   |      IF REQC = 'M' MOVE 'RECORD CHANGE' TO TITLEDO,                    | 

   |          MOVE 'MAKE CHANGES AND &quot;ENTER&quot; OR &quot;CLEAR&quot; TO CANCEL'          | 

   |              TO MSGDO,                                                 | 

   |      ELSE IF REQC = 'D',                                               | 

   |              MOVE 'PRESS &quot;CLEAR&quot; OR &quot;ENTER&quot; WHEN FINISHED'             | 

   |                  TO MSGDO.                                             | 

   |      MOVE CORRESPONDING ACCTREC TO ACCTDTLO.                           | 

   |      MOVE CORRESPONDING PAY-HIST (1) TO PAY-LINE.                      | 

   |      MOVE PAY-LINE TO HIST1DO.                                         | 

   |      MOVE CORRESPONDING PAY-HIST (2) TO PAY-LINE.                      | 

   |      MOVE PAY-LINE TO HIST2DO.                                         | 

   |      MOVE CORRESPONDING PAY-HIST (3) TO PAY-LINE.                      | 

   |      MOVE PAY-LINE TO HIST3DO.                                         | 

   |      IF REQC  = 'M' GO TO SEND-DETAIL,                                 | 

   |      ELSE IF REQC = 'P' GO TO PRINT-PROC.                              | 

   |      MOVE DFHBMASK TO                                                  | 

   |          SNAMEDA, FNAMEDA, MIDA, TTLDA, TELDA, ADDR1DA,                | 

   |          ADDR2DA, ADDR3DA, AUTH1DA, AUTH2DA, AUTH3DA,                  | 

   |          AUTH4DA, CARDSDA, IMODA, IDAYDA, IYRDA, RSNDA,                | 

   |          CCODEDA, APPRDA, SCODE1DA, SCODE2DA, SCODE3DA.                | 

   | *    SEND THE RECORD DETAIL MAP TO THE TERMINAL.                       | 

   |  SEND-DETAIL.                                                          | 

   |      EXEC CICS SEND MAP('ACCTDTL') MAPSET('ACCTSET') ERASE FREEKB      | 

   |          CURSOR END-EXEC.                                              | 

   |                                                                        | 

   |________________________________________________________________________| 

   Figure 43. Building the detail display map 

<p>

<p>

   Here are some explanatory notes. 

<p>

   <tt>REQC</tt> (request code) was moved to a working-storage field earlier in the 

   program.  It holds the user's &quot;request code.&quot; 

<p>

   What is happening in this code is as follows: 

<p>

   o   If the user request is to delete a record (<tt>IF</tt> <tt>REQC</tt> = X): 

<p>

       1.  The map title is changed from its default to <tt>DELETION</tt>. 

<p>

       2.  The cursor is placed under the &quot;verify&quot; field <tt>(MOVE</tt> <tt>-1</tt> <tt>TO</tt> <tt>VFYDL)</tt> 

           by a technique we'll explain shortly. 

<p>

       3.  The attribute byte for that field is changed from its map default 

           of autoskip to unprotected. 

<p>

       4.  Instructions for what to do next are put in the message area. 

<p>

   o   The cursor is placed under the surname field for all other types of 

       user requests <tt>(ELSE</tt> <tt>MOVE</tt> <tt>-1</tt> <tt>to</tt> <tt>SNAMEDL)</tt>. 

<p>

   o   If the request is for an addition: 

<p>

       1.  The title is made <tt>NEW</tt> <tt>RECORD</tt>. 

       2.  The titles at the bottom of the screen are given a nondisplay 

           attribute. 

       3.  The account field (from the request input) is placed in the output 

           map. 

       4.  Instructions are put into the message area. 

<p>

   o   If the request is a modification, the title and the message area are 

       set appropriately. 

<p>

   o   If the request is a display, instructions for what to do after the 

       display are put in the message area. 

<p>

   o   For all types of requests except adds, the display is built from the 

       record on file (<tt>MOVE</tt> <tt>CORRESPONDING</tt> <tt>ACCTREC</tt> <tt>...</tt>    through ...    <tt>MOVE</tt> 

       <tt>PAY-LINE</tt> <tt>TO</tt> <tt>HIST3DO</tt>). 

<p>

   o   If the request is to print a record, control goes to code at 

       <tt>PRINT-PROC</tt> that will do the special processing required to write to a 

       terminal other than the input terminal. 

<p>

   o   If the request is to display or delete, the attribute bytes of all the 

       data fields that can be entered or changed on an addition or a 

       modification are changed to autoskip.  This makes it clear to users 

       that they cannot change these fields in the current transaction. 

<p>

   o   For all request types except printing, the map is sent to the input 

       terminal. 

<p>

   We need to use a somewhat different type of <tt>SEND</tt> <tt>MAP</tt> command later in the 

   same program, when we have to redisplay the input (menu) map because of 

   some error, or to put a message on the screen.  Because the map is already 

   on the screen, it is unnecessary (and wasteful of line capacity) to send 

   what is already there again.  So we use the <tt>DATAONLY</tt> option, and we do not 

   erase the screen: 

<p>

<a name="FIGFIGUNIQ34">    ________________________________________________________________________  </a>

   |                                                                        | 

   |   EXEC CICS SEND MAP('ACCTMNU') MAPSET('ACCTSET')                      | 

   |       CURSOR DATAONLY FRSET ERASEAUP FREEKB END-EXEC.                  | 

   |                                                                        | 

   |________________________________________________________________________| 

<p>

   We also specify <tt>FRSET</tt> in this command.  This prevents fields that were 

   entered during the previous terminal interaction, and not rekeyed, from 

   being sent on the next transmission.  That is, only fields that the user 

   changes (probably because of an error) will be transmitted the next time 

   the terminal sends.  This reduces line transmission, but it requires the 

   transaction to save the input from the previous execution for the next 

   one.  We've a bit more to say about how to use <tt>FRSET</tt> in the notes that 

   accompany Line 163 of the program source code of <tt>ACCT01</tt>.  You'll find 

   these in <a href="">&quot;Program ACCT01: initial request processing&quot; in topic 2.10.2</a>. </pre> 
<hr> 
<br> 
<a href=""><img src="" border=0 alt="[Prev Topic]"></a> <a href=""><img src="" border=0 alt="[Next Topic]"></a> <cite> © Copyright IBM Corp. 1984, 1991</cite> 
<HR> 
<p>  
<h6><a href="">IBM BookManager® BookServer</a> Copyright 1989, 1999<a href="http://www.ibm.com/"> IBM</a> Corporation. All rights reserved.</h6> 
<p>  
</BODY>
</HTML>
