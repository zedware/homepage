<html>
<!-- DW6 -->
<head>
<title>Quick and dirty reference of DB2 for Windows</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
.style1 {font-size: larger}
-->
</style>
</head>
<body bgcolor="#FFFFFF"> 
<p align="center" class="style1">Quick and dirty reference of DB2 for Windows</p> 
<hr> 
<p>1. 对象默认所在的SCHEMA不一定是你想要的，最好是在对象名前加上你想要的SCHEMA名。例如要在我的表名和触发器名字前加上SCHEMA名。</p>
<p>2.触发器对应的执行逻辑中IF语句的条件要用()引起来。触发器后的执行逻辑其实就是存储过程的语法。<BR>
    <BR>
  3.   注意ELSEIF的拼写，不是两个分开的单词：ELSE IF。</p>
<p>4.过程体中的语句要以分号结尾。但是最后一个END之后不可以有分号。而且在GUI的命令中心里执行创建过程或触发器的语句时，要注意设置SQLTERM并在END后加一个SQLTERM（例如设置成!）。</p>
<p>5. DELETE操作上不可以创建BEFORE类型的触发器。</p>
<p>示例：</p>
<p>DROP TABLE PUBLIC.TEST</p>
<p>CREATE TABLE PUBLIC.TEST (<BR>
    
  ID INT NOT NULL PRIMARY KEY,<BR>
  
DATA   VARCHAR(100),   <BR>
  
SIGN INT  <BR>
  )</p>
<p>DROP TABLE PUBLIC.TEST_TEMP</p>
<p>CREATE TABLE PUBLIC.TEST_TEMP (<BR>
   
  ID INTEGER GENERATED BY DEFAULT AS   IDENTITY,<BR>
 
OTYPE INTEGER NOT NULL,  <BR>
 
OSTATUS INTEGER NOT NULL,  <BR>
 
OTIME   TIMESTAMP,  <BR>
 
OTIMES INTEGER NOT NULL,  <BR>
 
OCHANGED INTEGER NOT   NULL,  <BR>
 
OENTERTIME TIMESTAMP NOT NULL,  <BR>
 
ID_OLD INTEGER NOT NULL,  <BR>
 
ID_NEW   INTEGER,  <BR>
 
PRIMARY KEY (ID)  <BR>
  )</p>
<p>DROP TRIGGER PUBLIC.TR_TEST_DELETE</p>
<p>CREATE TRIGGER PUBLIC.TR_TEST_DELETE<BR>
     
  AFTER DELETE ON PUBLIC.TEST<BR>
     
REFERENCING OLD AS O  <BR>
   
FOR EACH ROW MODE DB2SQL  <BR>
  BEGIN ATOMIC<BR>
   
IF   (O.SIGN IS NULL) THEN  <BR>
      
INSERT INTO PUBLIC.TEST_TEMP(OTYPE, OSTATUS,   OTIME, OTIMES, OCHANGED, ID_OLD, ID_NEW)  <BR>
      
VALUES(0, 0,   CURRENT_TIMESTAMP, 0, 0, O.ID, NULL);  <BR>
   
ELSEIF (O.SIGN = 1) THEN  <BR>
        
UPDATE PUBLIC.TEST SET SIGN = 2 WHERE ID = O.ID;  <BR>
   
END IF;  <BR>
  END<BR>
  !</p>
<p>DB2 V8、V9的GUI工具在易用性方面还是比较差，怎么看也不像是一个专业的产品。</p>
<div align="center"> 
  <hr> 
  <div align="center"><a href="mailto:zedware@gmail.com">Copyright 2009-2010, zedware_at_gmail.com</a><br> 
    Last modified on
    <!-- #BeginDate format:fcIS1 -->Friday, 2009-10-02<!-- #EndDate --> 
  </div> 
</div> 
</body>
</html>
